<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_65) on Mon Dec 29 16:00:36 EST 2014 -->
<title>ChatServer</title>
<meta name="date" content="2014-12-29">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="ChatServer";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/ChatServer.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../code/java/chat/server/ChatMessageWriter.html" title="class in code.java.chat.server"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../code/java/chat/server/ChatServerClientHandler.html" title="class in code.java.chat.server"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?code/java/chat/server/ChatServer.html" target="_top">Frames</a></li>
<li><a href="ChatServer.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">code.java.chat.server</div>
<h2 title="Class ChatServer" class="title">Class ChatServer</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>code.java.chat.server.ChatServer</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd>java.lang.Runnable</dd>
</dl>
<hr>
<br>
<pre>public class <span class="strong">ChatServer</span>
extends java.lang.Object
implements java.lang.Runnable</pre>
<div class="block">An instance of this class is a server of a chat room hosted on PORT_NUMBER.
 It is created by an instance of ChatServerView, and for each chat client who
 asks to join the chat room it creates a new instance of
 ChatServerClientHandler running in a new thread to handle that client.
 <p/>
 <p/>
 ------------- | | ========== | S | - ChatServerClientHandler1 <-> | Client |
 | E | ========== PORT | R | ========== | V | - ChatServerClientHandler2 <-> |
 Client | | E | ========== | R | ========== | | - ChatServerClientHandler3 <->
 | Client | ------------- ==========
 <p/>
 <p/>
 Background notes on basic client-server networking:
 <p/>
 One standard way for a chat room to work is the hub-and-spoke model. That
 model uses a central server and many distributed clients. The server sits on
 some machine somewhere and client machines connect to the server to talk to
 each other by talking only to the server. But the server redirects their
 communications to all clients who have connected up to that moment. That way,
 the clients appear to be talking only to each other, yet they don't need to
 know each other's machine addresses. (This architecture can be generalized
 for many different applications; for example, multi-player online games.)
 <p/>
 Large programs are inherently complicated, but as soon as several instances
 of them have to work across a network they become even more complicated. That
 comes about because of two main sources of problems: network failure and
 human error.
 <p/>
 The java.net package supplies two classes, ServerSocket and Socket, to make
 it a little easier to link people and computers over networks. Those two
 classes work together.
 <p/>
 A ServerSocket represents a listener that waits for network connection
 requests from clients, while a Socket represents one endpoint of a network
 connection. (In fact, it's a TCP/IP connection, as opposed to some other one,
 like UDP or FTP or whatever, but that's not important here.) A Socket can be
 created by a client and sent as a connection request to a server, but a
 Socket can also be created by a server to handle a connection request from a
 client. (That is, Sockets can be either incoming or outgoing.) So a single
 server can create multiple sockets and can also handle multiple connections.
 <p/>
 Note that a ServerSocket does not itself handle connections; it just listens
 for connection requests and creates Sockets to handle the actual connections.
 Think of a ServerSocket like a servant who listens for knocks on a door (a
 port) and a Socket like a servant (one of many) who is sent to actually
 answer the door.
 <p/>
 When constructing a ServerSocket object you have to specify the port number
 (the door) on which the server will listen. That port number must be in the
 range 0 to 65535 (i.e. 2^16 - 1), and it should generally be greater than
 1024 (i.e. 2^10), as historically those smaller numbers were reserved for
 special servers (like telnet, mail, http, and so on) before the age of
 personal computers. The ServerSocket constructor might throw a
 SecurityException if you specify a smaller port number. Also, if you specify
 a port number for a port that is already in use, an IOException can occur.
 (This means, for example, that if you kill the Server and then try to restart
 it on the same port right away that port may be reported as busy.)
 <p/>
 Once you create a ServerSocket, it listens for connection requests. If the
 port isn't busy, the ServerSocket's accept() method will accept such a
 request, establish a connection with the currently requesting client, and
 then it will return a Socket that can be used for communication with that
 client. However, note that the accept() method will just sit there until
 someone knocks on the door. It *won't return* (the technical term is that it
 will *block*) until it receives a connection request (or until some error
 occurs). Also, note that the ServerSocket will continue listening for
 connections until it is close()d, or until some error occurs, or until the
 program dies in some way. So the way it usually works is that you put it in a
 loop and keep accept()ing as long as you want, and for each connection you
 accept(), you spawn a new thread to handle that, so that you don't get
 blocked while waiting for the next one. In this particular class, the class
 executed by such a newly spawned thread would be a new instance of
 ChatServerClientHandler.
 <p/>
 This class depends on classes ChatServerView, ChatServerClientHandler,
 ChatMessage, ChatMessageType, and ChatMessageWriter.
 <p/>
 Possible extensions for the adventurous (for advanced readers only):
 <p/>
 -could keep a log of chat connections and chat messages. -could generate
 internal ids to separate possible client name clashes. -could support
 multiple chat rooms. -could check for decayed client lines by spawning a ping
 thread that wakes up every few minutes to check to see if any connections are
 dead. that could take care of any clients who close connection without
 following the disconnect protocol and also any clients whose network
 connections rot or simply die (their computer died, their network card died,
 their router died, their isp died, there's a storm, they lost power, someone
 with a backhoe accidentally cut their cable, a bird pooped in their satellite
 dish, etc...). -could handle the port bind problem... that has to do with
 shutting down the ServerSocket itself instead of just the sockets that the
 threads create off of it. -might consider thread pooling to handle cases of
 heavy load. -server could be made a singleton since only one can occupy a
 port.
 <p/>
 Technical note (for advanced readers only):
 <p/>
 The ideal data structure to use here seems to be a map from a key to a tuple;
 and, at first, a natural choice for such a map's key might seem to be each
 client's name or userid. But since this is a network application, and an
 insecure and unencrypted one to boot, forcing clients to use their real
 names, or requiring them to use real userids, would be overly demanding---not
 to mention a security risk. Further, even just forcing clients to try to
 generate unique chatnames (or having the server generate unique random
 chatnames for them, which they and other chatters would then have to get used
 to) seems both artificial and a burden for the clients. So what we want is a
 casual-use chat system that would be workable over insecure and unencrypted
 lines by arbitrary clients with no prior agreement between them as to choice
 of chatname.
 <p/>
 Here's the workaround used here: Since the server must generate a new socket
 each time a client connects, it's feasible to use *that socket* as the map's
 key. The most natural map would then be from each client's socket to tuples
 containing that client's name (which is a String) and that client's output
 stream (which is a ChatMessageWriter, which is a custom subclass of
 ObjectOutputStream). But maps to tuples are awkward to write in Java because
 Java has no built-in notion of Tuple. So instead it seems reasonable to use
 two* maps, one from socket to client string and one from socket to output
 stream. (Stepping up one more complexity level to, say, a ConcurrentHashMap
 would be even more overkill for an introductory course.) The one downside is
 that clients would then be listed either in order of *addition to the
 chatroom* (if we used a LinkedHashMap for the socket-to-client map), or in
 sorted order by their *socket* (if we used a TreeMap for the socket-to-client
 map, which would of course take the client's socket as its key, not by the
 client's name). Of course, we could do more work and keep yet another map, or
 just a separate List, of current clients, and keep that sorted, so that
 whenever it changes that's what is broadcast, but for such a simple chat room
 program suite there seemed no point. So the simplest strategy seemed to be to
 go with a LinkedHashMap for the socket-to-client's name map and a plain old
 HashMap for the socket-to-chatclient's output stream map. Oh well.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../code/java/chat/server/ChatServer.html#ChatServer(code.java.chat.server.ChatServerView)">ChatServer</a></strong>(<a href="../../../../code/java/chat/server/ChatServerView.html" title="class in code.java.chat.server">ChatServerView</a>&nbsp;chatServerView)</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../code/java/chat/server/ChatServer.html#addToChattersList(java.net.Socket,%20java.lang.String)">addToChattersList</a></strong>(java.net.Socket&nbsp;socket,
                 java.lang.String&nbsp;chatClient)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../code/java/chat/server/ChatServer.html#broadcastChattersList()">broadcastChattersList</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../code/java/chat/server/ChatServer.html#broadcastMessage(code.java.chat.util.ChatMessageType,%20java.lang.String)">broadcastMessage</a></strong>(<a href="../../../../code/java/chat/util/ChatMessageType.html" title="enum in code.java.chat.util">ChatMessageType</a>&nbsp;type,
                java.lang.String&nbsp;string)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../code/java/chat/server/ChatServer.html#remove(java.net.Socket)">remove</a></strong>(java.net.Socket&nbsp;socket)</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../code/java/chat/server/ChatServer.html#removeFromChattersList(java.net.Socket)">removeFromChattersList</a></strong>(java.net.Socket&nbsp;socket)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../code/java/chat/server/ChatServer.html#report(java.lang.String)">report</a></strong>(java.lang.String&nbsp;string)</code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../code/java/chat/server/ChatServer.html#run()">run</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../code/java/chat/server/ChatServer.html#stop()">stop</a></strong>()</code>&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>equals, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="ChatServer(code.java.chat.server.ChatServerView)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ChatServer</h4>
<pre>public&nbsp;ChatServer(<a href="../../../../code/java/chat/server/ChatServerView.html" title="class in code.java.chat.server">ChatServerView</a>&nbsp;chatServerView)</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="run()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>run</h4>
<pre>public&nbsp;void&nbsp;run()</pre>
<dl>
<dt><strong>Specified by:</strong></dt>
<dd><code>run</code>&nbsp;in interface&nbsp;<code>java.lang.Runnable</code></dd>
</dl>
</li>
</ul>
<a name="stop()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>stop</h4>
<pre>public&nbsp;void&nbsp;stop()</pre>
</li>
</ul>
<a name="report(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>report</h4>
<pre>public&nbsp;void&nbsp;report(java.lang.String&nbsp;string)</pre>
</li>
</ul>
<a name="remove(java.net.Socket)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>remove</h4>
<pre>public&nbsp;void&nbsp;remove(java.net.Socket&nbsp;socket)
            throws java.io.IOException</pre>
<dl><dt><span class="strong">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd></dl>
</li>
</ul>
<a name="addToChattersList(java.net.Socket, java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>addToChattersList</h4>
<pre>public&nbsp;void&nbsp;addToChattersList(java.net.Socket&nbsp;socket,
                     java.lang.String&nbsp;chatClient)</pre>
</li>
</ul>
<a name="removeFromChattersList(java.net.Socket)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>removeFromChattersList</h4>
<pre>public&nbsp;void&nbsp;removeFromChattersList(java.net.Socket&nbsp;socket)</pre>
</li>
</ul>
<a name="broadcastChattersList()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>broadcastChattersList</h4>
<pre>public&nbsp;void&nbsp;broadcastChattersList()</pre>
</li>
</ul>
<a name="broadcastMessage(code.java.chat.util.ChatMessageType, java.lang.String)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>broadcastMessage</h4>
<pre>public&nbsp;void&nbsp;broadcastMessage(<a href="../../../../code/java/chat/util/ChatMessageType.html" title="enum in code.java.chat.util">ChatMessageType</a>&nbsp;type,
                    java.lang.String&nbsp;string)</pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/ChatServer.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../code/java/chat/server/ChatMessageWriter.html" title="class in code.java.chat.server"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../code/java/chat/server/ChatServerClientHandler.html" title="class in code.java.chat.server"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?code/java/chat/server/ChatServer.html" target="_top">Frames</a></li>
<li><a href="ChatServer.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
